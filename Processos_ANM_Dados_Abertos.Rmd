---
title: "Processos ANM"
subtitle: "<br /> RM de Belo Horizonte e RM do Colar Metropolitano de Belo Horizonte"
date: "`r Sys.Date()`"
output:
  # rmdformats::downcute:  
   rmdformats::robobook:    
     self_contained: true
     default_style: "light"
     downcute_theme: "default"
     highlight: kate
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(DT)
library(knitr)
options(editor = "notepad")
```


```{r carregamento, include=FALSE}
processos_ANM <- 
  readRDS("./data/ETL_Processos_ANM_Dados_Abertos_2023041115.Rds")

processos_ANM$ID <- 
  paste0("ID_", 
         gsub(processos_ANM$Municipio.s., pattern = ",.{1,}", replacement = "") |> 
           gsub(pattern = " - ", replacement = "") |> 
           gsub(pattern = "'", replacement = "") |> 
           stringr::str_squish() |> 
           gsub(pattern = " ", replacement = "")) |> 
           iconv(from = "UTF-8", to = "ASCII//TRANSLIT")


source("./R/geocod.R")

RM <-
  read.table(
    "./data/Regiões_Metropolitanas_IBGE.csv",
    header = TRUE, sep = ";",
    fill = TRUE, quote = "",
    fileEncoding = 'Latin1', encoding = "UTF-8")

colnames(RM)[5] <- c("RegMet")


# chave primária
RM$ID <- 
  paste0("ID_",
         RM$NOME_MUN |> iconv(from = "UTF-8", to = 'ASCII//TRANSLIT') |> 
           gsub(pattern = "'", replacement = "") |> 
           stringr::str_squish() |> gsub(pattern = " ", replacement = ""),
         RM$SIGLA_UF)


```

```{r subsetting, echo=FALSE}

RegMet <- c("RM de Belo Horizonte (MG)", 
            "Colar Metropolitano de Belo Horizonte (MG)")

RM_Alvo <- RM[RM$RegMet %in% RegMet, ]


processos_ANM <- 
  left_join(RM_Alvo, processos_ANM, by = "ID")

```

<br />

## Fase Processual

```{r, echo=FALSE}

table(processos_ANM$Fase.Atual) |> as.data.frame() |> arrange(desc(Freq)) |> 
    DT::datatable(
      caption = "Fase Processual",
      rownames = F,
      escape=FALSE,
      extensions = 'Buttons',
            options = list(dom = 'Blfrtip', 
                           buttons = c('excel'),
                           searching = FALSE,
                           paging = FALSE,
                           info= FALSE,
                           columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = 1))))

```

***

<br /><br />

## Municípios

```{r, echo=FALSE}

table(processos_ANM$Municipio.s.) |> as.data.frame() |> arrange(desc(Freq)) |> 
    DT::datatable(
      caption = "Municípios",
      rownames = F,
      escape=FALSE,
      extensions = 'Buttons',
            options = list(dom = 'Blfrtip', 
                           buttons = c('excel'),
                           searching = FALSE,
                           paging = TRUE,
                           info= FALSE,
                           columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = 1))))


```

***

<br /><br />

## Tipo de Uso

```{r, echo=FALSE}

table(processos_ANM$Tipo.s..de.Uso) |> as.data.frame() |> arrange(desc(Freq)) |> 
    DT::datatable(
      caption = "Tipo de Uso",
      rownames = F,
      escape=FALSE,
      extensions = 'Buttons',
            options = list(dom = 'Blfrtip', 
                           buttons = c('excel'),
                           searching = FALSE,
                           paging = TRUE,
                           info= FALSE,
                           columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = 1))))


```

***

<br />


## Substância

```{r, echo=FALSE}

table(processos_ANM$Substância.s.) |> as.data.frame() |> arrange(desc(Freq)) |> 
    DT::datatable(
      caption = "Substância",
      rownames = F,
      escape=FALSE,
      extensions = 'Buttons',
            options = list(dom = 'Blfrtip', 
                           buttons = c('excel'),
                           searching = FALSE,
                           paging = TRUE,
                           info= FALSE,
                           columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = 1))))
```



```{css, echo = FALSE, eval = T}

.page-inner section#content.normal {
  background-image: url("./img/anm315x66azul.png");
  background-position: top right;
  background-size: 20%;
  background-repeat: no-repeat;
}

.body-inner {
  background-image: url("./img/barra_horizontal_palito.png");
  background-position: bottom;
  background-size: 100%;
  background-repeat: no-repeat;
}

.title {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 30px;
  font-weight: bold;
  font-stretch: condensed;
  text-align:left;
    text-align:left;
    border-left: 7.5px solid #004C78;
    padding-left: 20px;
    height: 45px;
} 

.subtitle {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 70px;
  font-weight: bold;
  font-stretch: condensed;
  text-align:center;
}

.section.level2 h2 {
  color: #ffffff;
  font-family: acumin-pro, sans-serif; 
  font-size: 30px;
  font-weight: normal;
  font-stretch: condensed;
  text-align:left;
    border-left: 3.2px solid #ffffff;
    padding-left: 8px;
    height: 25px;
}

.h3,h4,h5,h6 {
  color: #004C78;
    font-family: acumin-pro, sans-serif;
  font-size: 24px;
  font-weight: medium;
  font-stretch: condensed;
  text-align:left;
}

p {
  text-align: justify;
}

caption {
	color: #262626;
	font-family: acumin-pro, sans-serif;
	font-size: 18px;
	font-weight: lighter;
	font-stretch: ultra-condensed;
	text-align: center;
	background-color: #dbd7d7;
	border: 0mm;
	padding: 12px;
	margin: 0mm;
}

.dataTables_wrapper .dt-buttons {
  float:none;  
  text-align:center;
}

```




